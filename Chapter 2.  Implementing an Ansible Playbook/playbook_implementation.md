
# Chapter 2: Implementing an Ansible Playbook  

## Goal
Create an inventory of managed hosts, write a simple Ansible Playbook, and run the playbook to automate tasks on those hosts.

## Objectives
- Describe Ansible inventory concepts and manage a static inventory file.  
- Describe where Ansible configuration files are located, how Ansible selects them, and edit them to apply changes to default settings.  
- Run a single Ansible automation task using an ad hoc command and explain some use cases for ad hoc commands.  
- Write a basic Ansible Playbook and run it using the `ansible-playbook` command.  
- Write a playbook that uses multiple plays and per-play privilege escalation, and effectively use `ansible-doc` to learn how to use new modules to implement tasks for a play.  

***

## Table of Contents
- [Building an Ansible Inventory](#building-an-ansible-inventory)  
- [Managing Ansible Configuration Files](#managing-ansible-configuration-files)  
- [Running Ad Hoc Commands](#running-ad-hoc-commands)  
- [Writing and Running Playbooks](#writing-and-running-playbooks)  
- [Implementing Multiple Plays](#implementing-multiple-plays)  
- [Lab: Implementing Playbooks](#lab-implementing-playbooks)  
- [Summary](#summary)  

***

## Sections
- Building an Ansible Inventory (and Guided Exercise)  
- Managing Ansible Configuration Files (and Guided Exercise)  
- Running Ad Hoc Commands (and Guided Exercise)  
- Writing and Running Playbooks (and Guided Exercise)  
- Implementing Multiple Plays (and Guided Exercise)  
- Lab: Implementing Playbooks  

***

## Building an Ansible Inventory

### Objectives
After completing this section, you should be able to describe Ansible inventory concepts and manage a static inventory file.

***

### Defining the Inventory
An **inventory** defines a collection of hosts that Ansible will manage. These hosts can also be assigned to **groups**, which can be managed collectively. Groups can contain child groups, and hosts can be members of multiple groups. The inventory can also set variables that apply to the hosts and groups that it defines.  

Host inventories can be defined in two different ways:  
- **Static inventory**: A host inventory defined by a text file.  
- **Dynamic inventory**: Generated by a script or other program using external information providers.  

***

### Specifying Managed Hosts with a Static Inventory
A static inventory file is a text file that specifies the managed hosts that Ansible targets. This file can be written in multiple formats — the most common being **INI-style** format.

#### Example (Simple List):
```ini
web1.example.com
web2.example.com
db1.example.com
db2.example.com
192.0.2.42
```

#### Example (Using Groups):
```ini
[webservers]
web1.example.com
web2.example.com
192.0.2.42

[db-servers]
db1.example.com
db2.example.com
```

***

### Hosts in Multiple Groups
Hosts can belong to multiple groups, making inventory management flexible.

```ini
[webservers]
web1.example.com
web2.example.com
192.0.2.42

[db-servers]
db1.example.com
db2.example.com

[east-datacenter]
web1.example.com
db1.example.com

[west-datacenter]
web2.example.com
db2.example.com

[production]
web1.example.com
web2.example.com
db1.example.com
db2.example.com

[development]
192.0.2.42
```

***

### Important Note
Two host groups always exist:  

- **all**: contains every host explicitly listed in the inventory.  
- **ungrouped**: contains every host not assigned to any group.  

***

### Defining Nested Groups
Host inventories can include **groups of host groups** by appending `:children` to the group name.

```ini
[usa]
washington1.example.com
washington2.example.com

[canada]
ontario01.example.com
ontario02.example.com

[north-america:children]
canada
usa
```

A nested group can also have its own managed hosts, which are merged with those inherited from child groups.  

***

### Simplifying Host Specifications with Ranges
Ranges allow shorter inventory definitions. Syntax: `[START:END]`. Supports **numeric** and **alphabetic** expansions.

#### Examples:
- `192.168.[4:7].[0:255]` → matches 192.168.4.0 through 192.168.7.255  
- `server[01:20].example.com` → server01 to server20  
- `[a:c].dns.example.com` → a.dns.example.com, b.dns.example.com, c.dns.example.com  
- `2001:db8::[a:f]` → IPv6 range from `2001:db8::a` to `2001:db8::f`  

```ini
[usa]
washington[1:2].example.com

[canada]
ontario[01:02].example.com
```

***

### Verifying the Inventory
Use the `ansible` command to test inventory contents.

```bash
[user@controlnode ~]$ ansible washington1.example.com --list-hosts
  hosts (1):
    washington1.example.com
```

```bash
[user@controlnode ~]$ ansible washington01.example.com --list-hosts
 [WARNING]: provided hosts list is empty, only localhost is available

  hosts (0):
```

List all hosts in a group:

```bash
[user@controlnode ~]$ ansible canada --list-hosts
  hosts (2):
    ontario01.example.com
    ontario02.example.com
```

***

### Important Warning
If a host and a host group **share the same name**, `ansible` will target the host and ignore the group.  
Best practice: ensure hostnames and group names are unique.  

***

### Overriding the Location of the Inventory
- Default static inventory file: `/etc/ansible/hosts`  
- Best practice: define custom inventory locations in the **Ansible configuration file**.  

You can override inventory on the command line using:  

```bash
ansible -i PATHNAME
ansible-playbook -i PATHNAME
```

***

### Defining Variables in the Inventory
You can declare variables in `inventory` files, applying them to specific hosts or groups.  
However, best practice is using dedicated **group_vars/** or **host_vars/** directories.  

***

### Describing a Dynamic Inventory
Dynamic inventory can be built using external services like Red Hat Satellite or AWS EC2.  
- This ensures the inventory is **always up-to-date** as infrastructure changes.  
- Community scripts exist, or you can write custom dynamic inventory scripts.  

Example: Automatically gathering inventory from AWS ensures new instances are instantly manageable by Ansible.  

***

## Managing Ansible Configuration Files
(*Covered in next section of the course material...*)  

## Running Ad Hoc Commands
(*Covered in next section of the course material...*)  

## Writing and Running Playbooks
(*Covered in next section of the course material...*)  

## Implementing Multiple Plays
(*Covered in next section of the course material...*)  

## Lab: Implementing Playbooks
(*Hands-on exercises...*)  

## Summary
This chapter introduced how to:
- Define Ansible inventories.  
- Manage static and dynamic host definitions.  
- Verify and structure host groups with ranges and nesting.  
- Override inventory files when running Ansible.  

